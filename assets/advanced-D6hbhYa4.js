import{r as p,j as t,c as U,R as E}from"./client-DD4c7S6m.js";const Q=e=>e<=0,T=(e,n)=>{const s=L(e,n);return n.stock-((s==null?void 0:s.quantity)||0)},L=(e,n)=>e.find(s=>s.product.id===n.id),R=(e,n)=>e.find(s=>s.product.id===n),O=(e,n)=>e.filter(s=>s.product.id!==n),W=(e,n)=>e.map(s=>s.product.id===n.id?{...s,quantity:Math.min(s.quantity+1,n.stock)}:s),J=(e,n)=>R(e,n.id)?W(e,n):[...e,{product:n,quantity:1}],H=(e,n,s)=>e.map(o=>{if(o.product.id===n){const c=o.product.stock,d=Math.max(0,Math.min(s,c));return d>0?{...o,quantity:d}:null}return o}).filter(o=>o!==null),_=e=>{const n=X(e);return e.product.price*e.quantity*(1-n)},z=(e,n)=>{const{totalBeforeDiscount:s,totalAfterDiscount:o}=Y(e),{totalAfterCouponDiscount:c,totalDiscount:d}=Z(s,o,n);return{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(c),totalDiscount:Math.round(d)}},G=e=>e.reduce((n,s)=>Math.max(n,s.rate),0),K=e=>{const{discounts:n}=e.product,{quantity:s}=e;let o=0;for(const c of n)s>=c.quantity&&(o=Math.max(o,c.rate));return o},X=e=>e.product.discounts.reduce((n,s)=>e.quantity>=s.quantity&&s.rate>n?s.rate:n,0),Y=e=>{const n=e.reduce((o,c)=>o+c.product.price*c.quantity,0),s=e.reduce((o,c)=>o+_(c),0);return{totalBeforeDiscount:n,totalAfterDiscount:s}},Z=(e,n,s)=>{const o=s?s.discountType==="amount"?Math.max(0,n-s.discountValue):n*(1-s.discountValue/100):n,c=e-o;return{totalAfterCouponDiscount:o,totalDiscount:c}},tt=()=>{const[e,n]=k("cart",[]),[s,o]=p.useState(null),c=(j,u)=>{const l=T(j,u);Q(l)||d(u)},d=j=>{n(u=>J(u,j))};return{cart:e,handleAddToCart:c,addToCart:d,removeFromCart:j=>{n(u=>O(u,j))},updateQuantity:(j,u)=>{n(l=>H(l,j,u))},applyCoupon:j=>{o(j)},calculateTotal:()=>z(e,s),selectedCoupon:s}},et=e=>{const[n,s]=k("coupons",e),[o,c]=p.useState({name:"",code:"",discountType:"percentage",discountValue:0}),d=u=>{x(u),c({name:"",code:"",discountType:"percentage",discountValue:0})},x=u=>{s(l=>[...l,u])};return{coupons:n,newCoupon:o,createCoupon:d,addCoupon:x,editNewCouponName:(u,l)=>{c({...u,name:l})},editNewCouponCode:(u,l)=>{c({...u,code:l})},editNewCouponDiscountType:(u,l)=>{c({...u,discountType:l})},editNewCouponDiscountValue:(u,l)=>{c({...u,discountValue:l})}}},S=(e,n)=>e.find(s=>s.id===n),nt=(e,n)=>e.discounts.filter((s,o)=>o!==n),st=e=>{const[n,s]=k("products",e),[o,c]=p.useState(new Set),[d,x]=p.useState(null),[a,b]=p.useState({quantity:0,rate:0}),[C,j]=p.useState(!1),[u,l]=p.useState({name:"",price:0,stock:0,discounts:[]}),D=r=>{const i={...r,id:Date.now().toString()};h(i),l({name:"",price:0,stock:0,discounts:[]}),j(!1)},h=r=>{s(i=>[...i,r])},w=r=>{s(i=>i.map(m=>m.id===r.id?r:m))};return{products:n,newProduct:u,newDiscount:a,openProductIds:o,showNewProductForm:C,editingProduct:d,createProduct:D,addProduct:h,updateProduct:w,toggleProductAccordion:r=>{c(i=>{const m=new Set(i);return m.has(r)?m.delete(r):m.add(r),m})},editProduct:r=>{x({...r})},productNameUpdate:(r,i)=>{if(d&&d.id===r){const m={...d,name:i};x(m)}},priceUpdate:(r,i)=>{if(d&&d.id===r){const m={...d,price:i};x(m)}},stockUpdate:(r,i,m)=>{const N=S(r,i);if(N){const f={...N,stock:m};w(f),x(f)}},editComplete:()=>{d&&(w(d),x(null))},addDiscount:(r,i)=>{const m=S(r,i);if(m&&d){const N={...m,discounts:[...m.discounts,a]};w(N),x(N),b({quantity:0,rate:0})}},removeDiscount:(r,i,m)=>{const N=S(r,i);if(N){const f={...N,discounts:nt(N,m)};w(f),x(f)}},editNewDiscountQuantity:(r,i)=>{b({...r,quantity:i})},editNewDiscountRate:(r,i)=>{b({...r,rate:i})},toggleShowNewProductForm:r=>{j(r)},editNewProductStock:(r,i)=>{l({...r,stock:i})},editNewProductPrice:(r,i)=>{l({...r,price:i})},editNewProductName:(r,i)=>{l({...r,name:i})}}},ot=()=>{const[e,n]=p.useState(!1);return{isAdmin:e,toggleAdmin:()=>{n(o=>!o)}}},k=(e,n)=>{const[s,o]=p.useState(()=>{try{const c=window.localStorage.getItem(e);return c?JSON.parse(c):n}catch(c){return console.error(c),n}});return p.useEffect(()=>{try{window.localStorage.setItem(e,JSON.stringify(s))}catch(c){console.error(c)}},[e,s]),[s,o]},A=p.createContext(null),ct=({children:e,products:n})=>{const s=st(n);return t.jsx(A.Provider,{value:s,children:e})},I=()=>{const e=p.useContext(A);if(!e)throw new Error("useProductContext muest be used within ProductProvider");return e},q=p.createContext(null),rt=({children:e})=>{const n=tt();return t.jsx(q.Provider,{value:n,children:e})},P=()=>{const e=p.useContext(q);if(!e)throw new Error("useCartContext must be used within CartProvider");return e},V=p.createContext(null),at=({children:e,coupons:n})=>{const s=et(n);return t.jsx(V.Provider,{value:s,children:e})},F=()=>{const e=p.useContext(V);if(!e)throw new Error("useCouponContext muest be used within CouponProvider");return e},M=p.createContext(null),dt=({children:e})=>{const n=ot();return t.jsx(M.Provider,{value:n,children:e})},B=()=>{const e=p.useContext(M);if(!e)throw new Error("useAuthContext must be used within AuthProvider");return e},it=()=>{const{isAdmin:e,toggleAdmin:n}=B();return t.jsx("nav",{className:"bg-blue-600 text-white p-4",children:t.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[t.jsx(ut,{children:"쇼핑몰 관리 시스템"}),t.jsx(lt,{onClick:n,children:e?"장바구니 페이지로":"관리자 페이지로"})]})})},ut=({children:e})=>t.jsx("h1",{className:"text-2xl font-bold",children:e}),lt=({onClick:e,children:n})=>t.jsx("button",{onClick:e,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:n}),xt=()=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx($,{children:"장바구니"}),t.jsx(ft,{})]}),mt=()=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx($,{children:"관리자 페이지"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(qt,{}),t.jsx(Vt,{})]})]}),pt=()=>{const{isAdmin:e}=B();return t.jsx("main",{className:"container mx-auto mt-6",children:e?t.jsx(mt,{}):t.jsx(xt,{})})},ht=({children:e,onClick:n,disabled:s})=>t.jsx("button",{className:`w-full px-3 py-1 rounded ${s?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,onClick:n,disabled:s,children:e}),$=({children:e})=>t.jsx("h2",{className:"text-3xl font-bold mb-6",children:e}),v=({children:e})=>t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:e}),gt=({onChange:e,options:n,placeholder:s})=>t.jsxs("select",{onChange:e,className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"",children:s}),n.map(o=>t.jsx("option",{value:o.value,children:o.label},o.value))]}),jt=({onClick:e})=>t.jsx("button",{onClick:e,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),bt=({onClick:e})=>t.jsx("button",{onClick:e,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),Nt=()=>{const{cart:e,removeFromCart:n,updateQuantity:s}=P();return t.jsx("div",{children:e.map(o=>{const c=K(o);return t.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:o.product.name}),t.jsx("br",{}),t.jsxs("span",{className:"text-sm text-gray-600",children:[o.product.price,"원 x ",o.quantity,c>0&&t.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),t.jsxs("div",{children:[t.jsx(bt,{onClick:()=>s(o.product.id,o.quantity-1)}),t.jsx(jt,{onClick:()=>s(o.product.id,o.quantity+1)}),t.jsx("button",{onClick:()=>n(o.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},o.product.id)})})},wt=()=>{const{selectedCoupon:e}=P();return e?t.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",e.name,"(",e.discountType==="amount"?`${e.discountValue}원`:`${e.discountValue}%`," ","할인)"]}):null},vt=()=>{const{calculateTotal:e}=P(),{totalBeforeDiscount:n,totalAfterDiscount:s,totalDiscount:o}=e();return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(v,{children:"주문 요약"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{children:["상품 금액: ",n.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]})},Ct=()=>{const{coupons:e}=F(),{applyCoupon:n}=P();return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(v,{children:"쿠폰 적용"}),t.jsx(gt,{onChange:s=>n(e[parseInt(s.target.value)]),placeholder:"쿠폰 선택",options:e.map((s,o)=>({value:o,label:`${s.name} - ${s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`}`}))}),t.jsx(wt,{})]})},yt=()=>t.jsxs(t.Fragment,{children:[t.jsx(v,{children:"장바구니 내역"}),t.jsx(Nt,{})]}),ft=()=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx(v,{children:"상품 목록"}),t.jsx(Pt,{})]}),t.jsxs("div",{children:[t.jsx(yt,{}),t.jsx(Ct,{}),t.jsx(vt,{})]})]}),Pt=()=>{const{products:e}=I();return t.jsx("div",{className:"space-y-2",children:e.map(n=>t.jsx(Dt,{product:n},n.id))})},Dt=({product:e})=>{const{cart:n,handleAddToCart:s}=P(),o=T(n,e),{id:c,name:d,price:x,discounts:a}=e;return t.jsxs("div",{"data-testid":`product-${c}`,className:"bg-white p-3 rounded shadow",children:[t.jsx(St,{name:d,price:x}),t.jsx(kt,{remainingStock:o,discounts:a}),t.jsx(It,{discounts:a}),t.jsx(ht,{onClick:()=>s(n,e),disabled:o<=0,children:o>0?"장바구니에 추가":"품절"})]})},St=({name:e,price:n})=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"font-semibold",children:e}),t.jsxs("span",{className:"text-gray-600",children:[n.toLocaleString(),"원"]})]}),kt=({remainingStock:e,discounts:n})=>t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[t.jsxs("span",{className:`font-medium ${e>0?"text-green-600":"text-red-600"}`,children:["재고: ",e,"개"]}),n.length>0&&t.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(G(n)*100).toFixed(0),"% 할인"]})]}),It=({discounts:e})=>e.length===0?null:t.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:e.map((n,s)=>t.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},s))}),Tt=()=>{const{newProduct:e,showNewProductForm:n,editNewProductName:s,editNewProductPrice:o,editNewProductStock:c,createProduct:d,toggleShowNewProductForm:x}=I();return t.jsxs("div",{children:[t.jsx("button",{onClick:()=>x(!n),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:n?"취소":"새 상품 추가"}),n&&t.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),t.jsx("input",{id:"productName",type:"text",value:e.name,onChange:a=>s(e,a.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),t.jsx("input",{id:"productPrice",type:"number",value:e.price,onChange:a=>o(e,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),t.jsx("input",{id:"productStock",type:"number",value:e.stock,onChange:a=>c(e,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx("button",{onClick:()=>d(e),className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})]})},At=()=>{const{products:e,newDiscount:n,openProductIds:s,editingProduct:o,toggleProductAccordion:c,editProduct:d,productNameUpdate:x,priceUpdate:a,stockUpdate:b,removeDiscount:C,addDiscount:j,editNewDiscountQuantity:u,editNewDiscountRate:l,editComplete:D}=I();return t.jsx("div",{className:"space-y-2",children:e.map((h,w)=>t.jsxs("div",{"data-testid":`product-${w+1}`,className:"bg-white p-4 rounded shadow",children:[t.jsxs("button",{"data-testid":"toggle-button",onClick:()=>c(h.id),className:"w-full text-left font-semibold",children:[h.name," - ",h.price,"원 (재고: ",h.stock,")"]}),s.has(h.id)&&t.jsx("div",{className:"mt-2",children:o&&o.id===h.id?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"상품명: "}),t.jsx("input",{type:"text",value:o.name,onChange:g=>x(h.id,g.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"가격: "}),t.jsx("input",{type:"number",value:o.price,onChange:g=>a(h.id,parseInt(g.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"재고: "}),t.jsx("input",{type:"number",value:o.stock,onChange:g=>b(e,h.id,parseInt(g.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),o.discounts.map((g,y)=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[g.quantity,"개 이상 구매 시"," ",g.rate*100,"% 할인"]}),t.jsx("button",{onClick:()=>C(e,h.id,y),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},y)),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"number",placeholder:"수량",value:n.quantity,onChange:g=>u(n,parseInt(g.target.value)),className:"w-1/3 p-2 border rounded"}),t.jsx("input",{type:"number",placeholder:"할인율 (%)",value:n.rate*100,onChange:g=>l(n,parseInt(g.target.value)/100),className:"w-1/3 p-2 border rounded"}),t.jsx("button",{onClick:()=>j(e,h.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),t.jsx("button",{onClick:D,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):t.jsxs("div",{children:[h.discounts.map((g,y)=>t.jsx("div",{className:"mb-2",children:t.jsxs("span",{children:[g.quantity,"개 이상 구매 시 ",g.rate*100,"% 할인"]})},y)),t.jsx("button",{"data-testid":"modify-button",onClick:()=>d(h),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},h.id))})},qt=()=>t.jsxs("div",{children:[t.jsx(v,{children:"상품 관리"}),t.jsx(Tt,{}),t.jsx(At,{})]}),Vt=()=>{const{coupons:e,newCoupon:n,createCoupon:s,editNewCouponName:o,editNewCouponCode:c,editNewCouponDiscountType:d,editNewCouponDiscountValue:x}=F();return t.jsxs("div",{children:[t.jsx(v,{children:"쿠폰 관리"}),t.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:n.name,onChange:a=>o(n,a.target.value),className:"w-full p-2 border rounded"}),t.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:n.code,onChange:a=>c(n,a.target.value),className:"w-full p-2 border rounded"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:n.discountType,onChange:a=>d(n,a.target.value),className:"w-full p-2 border rounded",children:[t.jsx("option",{value:"amount",children:"금액(원)"}),t.jsx("option",{value:"percentage",children:"할인율(%)"})]}),t.jsx("input",{type:"number",placeholder:"할인 값",value:n.discountValue,onChange:a=>x(n,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx("button",{onClick:()=>s(n),className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),t.jsx("div",{className:"space-y-2",children:e.map((a,b)=>t.jsxs("div",{"data-testid":`coupon-${b+1}`,className:"bg-gray-100 p-2 rounded",children:[a.name," (",a.code,"):",a.discountType==="amount"?`${a.discountValue}원`:`${a.discountValue}%`," ","할인"]},b))})]})]})]})},Ft=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],Mt=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],Bt=()=>t.jsx(dt,{children:t.jsx(ct,{products:Ft,children:t.jsx(at,{coupons:Mt,children:t.jsxs("div",{className:"min-h-screen bg-gray-100",children:[t.jsx(it,{}),t.jsx(rt,{children:t.jsx(pt,{})})]})})})});U.createRoot(document.getElementById("root")).render(t.jsx(E.StrictMode,{children:t.jsx(Bt,{})}));
