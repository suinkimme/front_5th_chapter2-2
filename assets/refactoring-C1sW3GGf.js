import{r as p,j as t,c as $,R as U}from"./client-DD4c7S6m.js";const E=e=>e<=0,I=(e,n)=>{const s=Q(e,n);return n.stock-((s==null?void 0:s.quantity)||0)},Q=(e,n)=>e.find(s=>s.product.id===n.id),R=(e,n)=>e.find(s=>s.product.id===n),L=(e,n)=>e.filter(s=>s.product.id!==n),O=(e,n)=>e.map(s=>s.product.id===n.id?{...s,quantity:Math.min(s.quantity+1,n.stock)}:s),W=(e,n)=>R(e,n.id)?O(e,n):[...e,{product:n,quantity:1}],H=(e,n,s)=>e.map(o=>{if(o.product.id===n){const c=o.product.stock,d=Math.max(0,Math.min(s,c));return d>0?{...o,quantity:d}:null}return o}).filter(o=>o!==null),_=e=>{const n=K(e);return e.product.price*e.quantity*(1-n)},z=(e,n)=>{const{totalBeforeDiscount:s,totalAfterDiscount:o}=X(e),{totalAfterCouponDiscount:c,totalDiscount:d}=Y(s,o,n);return{totalBeforeDiscount:Math.round(s),totalAfterDiscount:Math.round(c),totalDiscount:Math.round(d)}},G=e=>e.reduce((n,s)=>Math.max(n,s.rate),0),J=e=>{const{discounts:n}=e.product,{quantity:s}=e;let o=0;for(const c of n)s>=c.quantity&&(o=Math.max(o,c.rate));return o},K=e=>e.product.discounts.reduce((n,s)=>e.quantity>=s.quantity&&s.rate>n?s.rate:n,0),X=e=>{const n=e.reduce((o,c)=>o+c.product.price*c.quantity,0),s=e.reduce((o,c)=>o+_(c),0);return{totalBeforeDiscount:n,totalAfterDiscount:s}},Y=(e,n,s)=>{const o=s?s.discountType==="amount"?Math.max(0,n-s.discountValue):n*(1-s.discountValue/100):n,c=e-o;return{totalAfterCouponDiscount:o,totalDiscount:c}},Z=()=>{const[e,n]=p.useState([]),[s,o]=p.useState(null),c=(g,u)=>{const l=I(g,u);E(l)||d(u)},d=g=>{n(u=>W(u,g))};return{cart:e,handleAddToCart:c,addToCart:d,removeFromCart:g=>{n(u=>L(u,g))},updateQuantity:(g,u)=>{n(l=>H(l,g,u))},applyCoupon:g=>{o(g)},calculateTotal:()=>z(e,s),selectedCoupon:s}},tt=e=>{const[n,s]=p.useState(e),[o,c]=p.useState({name:"",code:"",discountType:"percentage",discountValue:0}),d=u=>{x(u),c({name:"",code:"",discountType:"percentage",discountValue:0})},x=u=>{s(l=>[...l,u])};return{coupons:n,newCoupon:o,createCoupon:d,addCoupon:x,editNewCouponName:(u,l)=>{c({...u,name:l})},editNewCouponCode:(u,l)=>{c({...u,code:l})},editNewCouponDiscountType:(u,l)=>{c({...u,discountType:l})},editNewCouponDiscountValue:(u,l)=>{c({...u,discountValue:l})}}},D=(e,n)=>e.find(s=>s.id===n),et=(e,n)=>e.discounts.filter((s,o)=>o!==n),nt=e=>{const[n,s]=p.useState(e),[o,c]=p.useState(new Set),[d,x]=p.useState(null),[a,b]=p.useState({quantity:0,rate:0}),[C,g]=p.useState(!1),[u,l]=p.useState({name:"",price:0,stock:0,discounts:[]}),k=r=>{const i={...r,id:Date.now().toString()};h(i),l({name:"",price:0,stock:0,discounts:[]}),g(!1)},h=r=>{s(i=>[...i,r])},v=r=>{s(i=>i.map(m=>m.id===r.id?r:m))};return{products:n,newProduct:u,newDiscount:a,openProductIds:o,showNewProductForm:C,editingProduct:d,createProduct:k,addProduct:h,updateProduct:v,toggleProductAccordion:r=>{c(i=>{const m=new Set(i);return m.has(r)?m.delete(r):m.add(r),m})},editProduct:r=>{x({...r})},productNameUpdate:(r,i)=>{if(d&&d.id===r){const m={...d,name:i};x(m)}},priceUpdate:(r,i)=>{if(d&&d.id===r){const m={...d,price:i};x(m)}},stockUpdate:(r,i,m)=>{const N=D(r,i);if(N){const f={...N,stock:m};v(f),x(f)}},editComplete:()=>{d&&(v(d),x(null))},addDiscount:(r,i)=>{const m=D(r,i);if(m&&d){const N={...m,discounts:[...m.discounts,a]};v(N),x(N),b({quantity:0,rate:0})}},removeDiscount:(r,i,m)=>{const N=D(r,i);if(N){const f={...N,discounts:et(N,m)};v(f),x(f)}},editNewDiscountQuantity:(r,i)=>{b({...r,quantity:i})},editNewDiscountRate:(r,i)=>{b({...r,rate:i})},toggleShowNewProductForm:r=>{g(r)},editNewProductStock:(r,i)=>{l({...r,stock:i})},editNewProductPrice:(r,i)=>{l({...r,price:i})},editNewProductName:(r,i)=>{l({...r,name:i})}}},st=()=>{const[e,n]=p.useState(!1);return{isAdmin:e,toggleAdmin:()=>{n(o=>!o)}}},T=p.createContext(null),ot=({children:e,products:n})=>{const s=nt(n);return t.jsx(T.Provider,{value:s,children:e})},S=()=>{const e=p.useContext(T);if(!e)throw new Error("useProductContext muest be used within ProductProvider");return e},A=p.createContext(null),ct=({children:e})=>{const n=Z();return t.jsx(A.Provider,{value:n,children:e})},P=()=>{const e=p.useContext(A);if(!e)throw new Error("useCartContext must be used within CartProvider");return e},q=p.createContext(null),rt=({children:e,coupons:n})=>{const s=tt(n);return t.jsx(q.Provider,{value:s,children:e})},F=()=>{const e=p.useContext(q);if(!e)throw new Error("useCouponContext muest be used within CouponProvider");return e},V=p.createContext(null),at=({children:e})=>{const n=st();return t.jsx(V.Provider,{value:n,children:e})},M=()=>{const e=p.useContext(V);if(!e)throw new Error("useAuthContext must be used within AuthProvider");return e},dt=()=>{const{isAdmin:e,toggleAdmin:n}=M();return t.jsx("nav",{className:"bg-blue-600 text-white p-4",children:t.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[t.jsx(it,{children:"쇼핑몰 관리 시스템"}),t.jsx(ut,{onClick:n,children:e?"장바구니 페이지로":"관리자 페이지로"})]})})},it=({children:e})=>t.jsx("h1",{className:"text-2xl font-bold",children:e}),ut=({onClick:e,children:n})=>t.jsx("button",{onClick:e,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:n}),lt=()=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx(B,{children:"장바구니"}),t.jsx(yt,{})]}),xt=()=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx(B,{children:"관리자 페이지"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(At,{}),t.jsx(qt,{})]})]}),mt=()=>{const{isAdmin:e}=M();return t.jsx("main",{className:"container mx-auto mt-6",children:e?t.jsx(xt,{}):t.jsx(lt,{})})},pt=({children:e,onClick:n,disabled:s})=>t.jsx("button",{className:`w-full px-3 py-1 rounded ${s?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,onClick:n,disabled:s,children:e}),B=({children:e})=>t.jsx("h2",{className:"text-3xl font-bold mb-6",children:e}),w=({children:e})=>t.jsx("h2",{className:"text-2xl font-semibold mb-4",children:e}),ht=({onChange:e,options:n,placeholder:s})=>t.jsxs("select",{onChange:e,className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"",children:s}),n.map(o=>t.jsx("option",{value:o.value,children:o.label},o.value))]}),jt=({onClick:e})=>t.jsx("button",{onClick:e,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),gt=({onClick:e})=>t.jsx("button",{onClick:e,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),bt=()=>{const{cart:e,removeFromCart:n,updateQuantity:s}=P();return t.jsx("div",{children:e.map(o=>{const c=J(o);return t.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:o.product.name}),t.jsx("br",{}),t.jsxs("span",{className:"text-sm text-gray-600",children:[o.product.price,"원 x ",o.quantity,c>0&&t.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),t.jsxs("div",{children:[t.jsx(gt,{onClick:()=>s(o.product.id,o.quantity-1)}),t.jsx(jt,{onClick:()=>s(o.product.id,o.quantity+1)}),t.jsx("button",{onClick:()=>n(o.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},o.product.id)})})},Nt=()=>{const{selectedCoupon:e}=P();return e?t.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",e.name,"(",e.discountType==="amount"?`${e.discountValue}원`:`${e.discountValue}%`," ","할인)"]}):null},vt=()=>{const{calculateTotal:e}=P(),{totalBeforeDiscount:n,totalAfterDiscount:s,totalDiscount:o}=e();return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(w,{children:"주문 요약"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{children:["상품 금액: ",n.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]})},wt=()=>{const{coupons:e}=F(),{applyCoupon:n}=P();return t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(w,{children:"쿠폰 적용"}),t.jsx(ht,{onChange:s=>n(e[parseInt(s.target.value)]),placeholder:"쿠폰 선택",options:e.map((s,o)=>({value:o,label:`${s.name} - ${s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`}`}))}),t.jsx(Nt,{})]})},Ct=()=>t.jsxs(t.Fragment,{children:[t.jsx(w,{children:"장바구니 내역"}),t.jsx(bt,{})]}),yt=()=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx(w,{children:"상품 목록"}),t.jsx(ft,{})]}),t.jsxs("div",{children:[t.jsx(Ct,{}),t.jsx(wt,{}),t.jsx(vt,{})]})]}),ft=()=>{const{products:e}=S();return t.jsx("div",{className:"space-y-2",children:e.map(n=>t.jsx(Pt,{product:n},n.id))})},Pt=({product:e})=>{const{cart:n,handleAddToCart:s}=P(),o=I(n,e),{id:c,name:d,price:x,discounts:a}=e;return t.jsxs("div",{"data-testid":`product-${c}`,className:"bg-white p-3 rounded shadow",children:[t.jsx(kt,{name:d,price:x}),t.jsx(Dt,{remainingStock:o,discounts:a}),t.jsx(St,{discounts:a}),t.jsx(pt,{onClick:()=>s(n,e),disabled:o<=0,children:o>0?"장바구니에 추가":"품절"})]})},kt=({name:e,price:n})=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"font-semibold",children:e}),t.jsxs("span",{className:"text-gray-600",children:[n.toLocaleString(),"원"]})]}),Dt=({remainingStock:e,discounts:n})=>t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[t.jsxs("span",{className:`font-medium ${e>0?"text-green-600":"text-red-600"}`,children:["재고: ",e,"개"]}),n.length>0&&t.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(G(n)*100).toFixed(0),"% 할인"]})]}),St=({discounts:e})=>e.length===0?null:t.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:e.map((n,s)=>t.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},s))}),It=()=>{const{newProduct:e,showNewProductForm:n,editNewProductName:s,editNewProductPrice:o,editNewProductStock:c,createProduct:d,toggleShowNewProductForm:x}=S();return t.jsxs("div",{children:[t.jsx("button",{onClick:()=>x(!n),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:n?"취소":"새 상품 추가"}),n&&t.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),t.jsx("input",{id:"productName",type:"text",value:e.name,onChange:a=>s(e,a.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),t.jsx("input",{id:"productPrice",type:"number",value:e.price,onChange:a=>o(e,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),t.jsx("input",{id:"productStock",type:"number",value:e.stock,onChange:a=>c(e,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx("button",{onClick:()=>d(e),className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})]})},Tt=()=>{const{products:e,newDiscount:n,openProductIds:s,editingProduct:o,toggleProductAccordion:c,editProduct:d,productNameUpdate:x,priceUpdate:a,stockUpdate:b,removeDiscount:C,addDiscount:g,editNewDiscountQuantity:u,editNewDiscountRate:l,editComplete:k}=S();return t.jsx("div",{className:"space-y-2",children:e.map((h,v)=>t.jsxs("div",{"data-testid":`product-${v+1}`,className:"bg-white p-4 rounded shadow",children:[t.jsxs("button",{"data-testid":"toggle-button",onClick:()=>c(h.id),className:"w-full text-left font-semibold",children:[h.name," - ",h.price,"원 (재고: ",h.stock,")"]}),s.has(h.id)&&t.jsx("div",{className:"mt-2",children:o&&o.id===h.id?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"상품명: "}),t.jsx("input",{type:"text",value:o.name,onChange:j=>x(h.id,j.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"가격: "}),t.jsx("input",{type:"number",value:o.price,onChange:j=>a(h.id,parseInt(j.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"재고: "}),t.jsx("input",{type:"number",value:o.stock,onChange:j=>b(e,h.id,parseInt(j.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),o.discounts.map((j,y)=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[j.quantity,"개 이상 구매 시"," ",j.rate*100,"% 할인"]}),t.jsx("button",{onClick:()=>C(e,h.id,y),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},y)),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"number",placeholder:"수량",value:n.quantity,onChange:j=>u(n,parseInt(j.target.value)),className:"w-1/3 p-2 border rounded"}),t.jsx("input",{type:"number",placeholder:"할인율 (%)",value:n.rate*100,onChange:j=>l(n,parseInt(j.target.value)/100),className:"w-1/3 p-2 border rounded"}),t.jsx("button",{onClick:()=>g(e,h.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),t.jsx("button",{onClick:k,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):t.jsxs("div",{children:[h.discounts.map((j,y)=>t.jsx("div",{className:"mb-2",children:t.jsxs("span",{children:[j.quantity,"개 이상 구매 시 ",j.rate*100,"% 할인"]})},y)),t.jsx("button",{"data-testid":"modify-button",onClick:()=>d(h),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},h.id))})},At=()=>t.jsxs("div",{children:[t.jsx(w,{children:"상품 관리"}),t.jsx(It,{}),t.jsx(Tt,{})]}),qt=()=>{const{coupons:e,newCoupon:n,createCoupon:s,editNewCouponName:o,editNewCouponCode:c,editNewCouponDiscountType:d,editNewCouponDiscountValue:x}=F();return t.jsxs("div",{children:[t.jsx(w,{children:"쿠폰 관리"}),t.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:n.name,onChange:a=>o(n,a.target.value),className:"w-full p-2 border rounded"}),t.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:n.code,onChange:a=>c(n,a.target.value),className:"w-full p-2 border rounded"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:n.discountType,onChange:a=>d(n,a.target.value),className:"w-full p-2 border rounded",children:[t.jsx("option",{value:"amount",children:"금액(원)"}),t.jsx("option",{value:"percentage",children:"할인율(%)"})]}),t.jsx("input",{type:"number",placeholder:"할인 값",value:n.discountValue,onChange:a=>x(n,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),t.jsx("button",{onClick:()=>s(n),className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),t.jsx("div",{className:"space-y-2",children:e.map((a,b)=>t.jsxs("div",{"data-testid":`coupon-${b+1}`,className:"bg-gray-100 p-2 rounded",children:[a.name," (",a.code,"):",a.discountType==="amount"?`${a.discountValue}원`:`${a.discountValue}%`," ","할인"]},b))})]})]})]})},Ft=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],Vt=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],Mt=()=>t.jsx(at,{children:t.jsx(ot,{products:Ft,children:t.jsx(rt,{coupons:Vt,children:t.jsxs("div",{className:"min-h-screen bg-gray-100",children:[t.jsx(dt,{}),t.jsx(ct,{children:t.jsx(mt,{})})]})})})});$.createRoot(document.getElementById("root")).render(t.jsx(U.StrictMode,{children:t.jsx(Mt,{})}));
