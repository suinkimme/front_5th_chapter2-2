import{r as x,j as e,c as U,R as E}from"./client-DD4c7S6m.js";const G=t=>t<=0,T=(t,n)=>{const s=Q(t,n);return n.stock-((s==null?void 0:s.quantity)||0)},Q=(t,n)=>t.find(s=>s.product.id===n.id),L=(t,n)=>t.find(s=>s.product.id===n),O=(t,n)=>t.filter(s=>s.product.id!==n),W=(t,n)=>t.map(s=>s.product.id===n.id?{...s,quantity:Math.min(s.quantity+1,n.stock)}:s),H=(t,n)=>L(t,n.id)?W(t,n):[...t,{product:n,quantity:1}],_=(t,n,s)=>t.map(o=>{if(o.product.id===n){const c=o.product.stock,r=Math.max(0,Math.min(s,c));return r>0?{...o,quantity:r}:null}return o}).filter(o=>o!==null),z=t=>{const n=Y(t);return t.product.price*t.quantity*(1-n)},J=(t,n,s)=>{const{totalBeforeDiscount:o,totalAfterDiscount:c}=Z(t),{totalAfterGradeDiscount:r,totalDiscount:l}=ee(o,c,n,s);return{totalBeforeDiscount:Math.round(o),totalAfterDiscount:Math.round(r),totalDiscount:Math.round(l)}},K=t=>t.reduce((n,s)=>Math.max(n,s.rate),0),X=t=>{const{discounts:n}=t.product,{quantity:s}=t;let o=0;for(const c of n)s>=c.quantity&&(o=Math.max(o,c.rate));return o},Y=t=>t.product.discounts.reduce((n,s)=>t.quantity>=s.quantity&&s.rate>n?s.rate:n,0),Z=t=>{const n=t.reduce((o,c)=>o+c.product.price*c.quantity,0),s=t.reduce((o,c)=>o+z(c),0);return{totalBeforeDiscount:n,totalAfterDiscount:s}},ee=(t,n,s,o)=>{const c=s?s.discountType==="amount"?Math.max(0,n-s.discountValue):n*(1-s.discountValue/100):n,r=o?c*(1-o.discountRate/100):c,l=t-r;return{totalAfterGradeDiscount:r,totalDiscount:l}},te=()=>{const[t,n]=x.useState([]),[s,o]=x.useState(null),[c,r]=x.useState([{name:"VIP",discountRate:10},{name:"골드",discountRate:7},{name:"실버",discountRate:5},{name:"일반",discountRate:3}]),[l,d]=x.useState(null),N=i=>{r(g=>[...g,i])},f=i=>{d(i)},w=(i,g)=>{const D=T(i,g);G(D)||p(g)},p=i=>{n(g=>H(g,i))};return{cart:t,grade:c,selectedCoupon:s,selectedGrade:l,handleAddToCart:w,addToCart:p,removeFromCart:i=>{n(g=>O(g,i))},updateQuantity:(i,g)=>{n(D=>_(D,i,g))},applyCoupon:i=>{o(i)},calculateTotal:()=>J(t,s,l),addGrade:N,selectGrade:f}},ne=t=>{const[n,s]=x.useState(t),[o,c]=x.useState({name:"",code:"",discountType:"percentage",discountValue:0}),r=p=>{l(p),c({name:"",code:"",discountType:"percentage",discountValue:0})},l=p=>{s(j=>[...j,p])};return{coupons:n,newCoupon:o,createCoupon:r,addCoupon:l,editNewCouponName:(p,j)=>{c({...p,name:j})},editNewCouponCode:(p,j)=>{c({...p,code:j})},editNewCouponDiscountType:(p,j)=>{c({...p,discountType:j})},editNewCouponDiscountValue:(p,j)=>{c({...p,discountValue:j})}}},S=(t,n)=>t.find(s=>s.id===n),se=(t,n)=>t.discounts.filter((s,o)=>o!==n),oe=t=>{const[n,s]=x.useState(t),[o,c]=x.useState(new Set),[r,l]=x.useState(null),[d,N]=x.useState({quantity:0,rate:0}),[f,w]=x.useState(!1),[p,j]=x.useState({name:"",price:0,stock:0,discounts:[]}),k=a=>{const u={...a,id:Date.now().toString()};h(u),j({name:"",price:0,stock:0,discounts:[]}),w(!1)},h=a=>{s(u=>[...u,a])},v=a=>{s(u=>u.map(m=>m.id===a.id?a:m))};return{products:n,newProduct:p,newDiscount:d,openProductIds:o,showNewProductForm:f,editingProduct:r,createProduct:k,addProduct:h,updateProduct:v,toggleProductAccordion:a=>{c(u=>{const m=new Set(u);return m.has(a)?m.delete(a):m.add(a),m})},editProduct:a=>{l({...a})},productNameUpdate:(a,u)=>{if(r&&r.id===a){const m={...r,name:u};l(m)}},priceUpdate:(a,u)=>{if(r&&r.id===a){const m={...r,price:u};l(m)}},stockUpdate:(a,u,m)=>{const b=S(a,u);if(b){const P={...b,stock:m};v(P),l(P)}},editComplete:()=>{r&&(v(r),l(null))},addDiscount:(a,u)=>{const m=S(a,u);if(m&&r){const b={...m,discounts:[...m.discounts,d]};v(b),l(b),N({quantity:0,rate:0})}},removeDiscount:(a,u,m)=>{const b=S(a,u);if(b){const P={...b,discounts:se(b,m)};v(P),l(P)}},editNewDiscountQuantity:(a,u)=>{N({...a,quantity:u})},editNewDiscountRate:(a,u)=>{N({...a,rate:u})},toggleShowNewProductForm:a=>{w(a)},editNewProductStock:(a,u)=>{j({...a,stock:u})},editNewProductPrice:(a,u)=>{j({...a,price:u})},editNewProductName:(a,u)=>{j({...a,name:u})}}},ce=()=>{const[t,n]=x.useState(!1);return{isAdmin:t,toggleAdmin:()=>{n(o=>!o)}}},A=x.createContext(null),ae=({children:t,products:n})=>{const s=oe(n);return e.jsx(A.Provider,{value:s,children:t})},I=()=>{const t=x.useContext(A);if(!t)throw new Error("useProductContext muest be used within ProductProvider");return t},q=x.createContext(null),re=({children:t})=>{const n=te();return e.jsx(q.Provider,{value:n,children:t})},C=()=>{const t=x.useContext(q);if(!t)throw new Error("useCartContext must be used within CartProvider");return t},F=x.createContext(null),de=({children:t,coupons:n})=>{const s=ne(n);return e.jsx(F.Provider,{value:s,children:t})},R=()=>{const t=x.useContext(F);if(!t)throw new Error("useCouponContext muest be used within CouponProvider");return t},V=x.createContext(null),ie=({children:t})=>{const n=ce();return e.jsx(V.Provider,{value:n,children:t})},M=()=>{const t=x.useContext(V);if(!t)throw new Error("useAuthContext must be used within AuthProvider");return t},ue=()=>{const{isAdmin:t,toggleAdmin:n}=M();return e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx(le,{children:"쇼핑몰 관리 시스템"}),e.jsx(xe,{onClick:n,children:t?"장바구니 페이지로":"관리자 페이지로"})]})})},le=({children:t})=>e.jsx("h1",{className:"text-2xl font-bold",children:t}),xe=({onClick:t,children:n})=>e.jsx("button",{onClick:t,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:n}),me=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx($,{children:"장바구니"}),e.jsx(fe,{})]}),pe=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx($,{children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(qe,{}),e.jsx(Fe,{}),e.jsx(Re,{})]})]}),he=()=>{const{isAdmin:t}=M();return e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(pe,{}):e.jsx(me,{})})},B=({children:t,onClick:n,disabled:s})=>e.jsx("button",{className:`w-full px-3 py-1 rounded ${s?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,onClick:n,disabled:s,children:t}),$=({children:t})=>e.jsx("h2",{className:"text-3xl font-bold mb-6",children:t}),y=({children:t})=>e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:t}),je=({onChange:t,options:n,placeholder:s})=>e.jsxs("select",{onChange:t,className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:s}),n.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),ge=({onClick:t})=>e.jsx("button",{onClick:t,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),Ne=({onClick:t})=>e.jsx("button",{onClick:t,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),be=()=>{const{cart:t,removeFromCart:n,updateQuantity:s}=C();return e.jsx("div",{children:t.map(o=>{const c=X(o);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:o.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o.product.price,"원 x ",o.quantity,c>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(Ne,{onClick:()=>s(o.product.id,o.quantity-1)}),e.jsx(ge,{onClick:()=>s(o.product.id,o.quantity+1)}),e.jsx("button",{onClick:()=>n(o.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},o.product.id)})})},ve=()=>{const{selectedCoupon:t}=C();return t?e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인)"]}):null},we=()=>{const{calculateTotal:t}=C(),{totalBeforeDiscount:n,totalAfterDiscount:s,totalDiscount:o}=t();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(y,{children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",n.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]})},Ce=()=>{const{coupons:t}=R(),{applyCoupon:n}=C();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(y,{children:"쿠폰 적용"}),e.jsx(je,{onChange:s=>n(t[parseInt(s.target.value)]),placeholder:"쿠폰 선택",options:t.map((s,o)=>({value:o,label:`${s.name} - ${s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`}`}))}),e.jsx(ve,{})]})},ye=()=>e.jsxs(e.Fragment,{children:[e.jsx(y,{children:"장바구니 내역"}),e.jsx(be,{})]}),fe=()=>{const{grade:t,selectedGrade:n,selectGrade:s}=C();return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(y,{children:"상품 목록"}),e.jsx(Pe,{}),e.jsx("div",{className:"flex flex-row gap-2",children:t.map(o=>e.jsxs("div",{children:[e.jsx("input",{type:"radio",name:"grade",id:o.name,checked:(n==null?void 0:n.name)===o.name,onChange:()=>s(o)}),e.jsx("label",{htmlFor:o.name,children:o.name})]},o.name))})]}),e.jsxs("div",{children:[e.jsx(ye,{}),e.jsx(Ce,{}),e.jsx(we,{})]})]})},Pe=()=>{const{products:t}=I();return e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsx(ke,{product:n},n.id))})},ke=({product:t})=>{const{cart:n,handleAddToCart:s}=C(),o=T(n,t),{id:c,name:r,price:l,discounts:d}=t;return e.jsxs("div",{"data-testid":`product-${c}`,className:"bg-white p-3 rounded shadow",children:[e.jsx(De,{name:r,price:l}),e.jsx(Se,{remainingStock:o,discounts:d}),e.jsx(Ie,{discounts:d}),e.jsx(B,{onClick:()=>s(n,t),disabled:o<=0,children:o>0?"장바구니에 추가":"품절"})]})},De=({name:t,price:n})=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsxs("span",{className:"text-gray-600",children:[n.toLocaleString(),"원"]})]}),Se=({remainingStock:t,discounts:n})=>e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${t>0?"text-green-600":"text-red-600"}`,children:["재고: ",t,"개"]}),n.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(K(n)*100).toFixed(0),"% 할인"]})]}),Ie=({discounts:t})=>t.length===0?null:e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.map((n,s)=>e.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},s))}),Te=()=>{const{newProduct:t,showNewProductForm:n,editNewProductName:s,editNewProductPrice:o,editNewProductStock:c,createProduct:r,toggleShowNewProductForm:l}=I();return e.jsxs("div",{children:[e.jsx("button",{onClick:()=>l(!n),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:n?"취소":"새 상품 추가"}),n&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:d=>s(t,d.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:d=>o(t,parseInt(d.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:d=>c(t,parseInt(d.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:()=>r(t),className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})]})},Ae=()=>{const{products:t,newDiscount:n,openProductIds:s,editingProduct:o,toggleProductAccordion:c,editProduct:r,productNameUpdate:l,priceUpdate:d,stockUpdate:N,removeDiscount:f,addDiscount:w,editNewDiscountQuantity:p,editNewDiscountRate:j,editComplete:k}=I();return e.jsx("div",{className:"space-y-2",children:t.map((h,v)=>e.jsxs("div",{"data-testid":`product-${v+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>c(h.id),className:"w-full text-left font-semibold",children:[h.name," - ",h.price,"원 (재고: ",h.stock,")"]}),s.has(h.id)&&e.jsx("div",{className:"mt-2",children:o&&o.id===h.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:o.name,onChange:i=>l(h.id,i.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:o.price,onChange:i=>d(h.id,parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:o.stock,onChange:i=>N(t,h.id,parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),o.discounts.map((i,g)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[i.quantity,"개 이상 구매 시"," ",i.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>f(t,h.id,g),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},g)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:n.quantity,onChange:i=>p(n,parseInt(i.target.value)),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:n.rate*100,onChange:i=>j(n,parseInt(i.target.value)/100),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>w(t,h.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:k,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[h.discounts.map((i,g)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[i.quantity,"개 이상 구매 시 ",i.rate*100,"% 할인"]})},g)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>r(h),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},h.id))})},qe=()=>e.jsxs("div",{children:[e.jsx(y,{children:"상품 관리"}),e.jsx(Te,{}),e.jsx(Ae,{})]}),Fe=()=>{const{coupons:t,newCoupon:n,createCoupon:s,editNewCouponName:o,editNewCouponCode:c,editNewCouponDiscountType:r,editNewCouponDiscountValue:l}=R();return e.jsxs("div",{children:[e.jsx(y,{children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:n.name,onChange:d=>o(n,d.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:n.code,onChange:d=>c(n,d.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:n.discountType,onChange:d=>r(n,d.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:n.discountValue,onChange:d=>l(n,parseInt(d.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:()=>s(n),className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((d,N)=>e.jsxs("div",{"data-testid":`coupon-${N+1}`,className:"bg-gray-100 p-2 rounded",children:[d.name," (",d.code,"):",d.discountType==="amount"?`${d.discountValue}원`:`${d.discountValue}%`," ","할인"]},N))})]})]})]})},Re=()=>{const[t,n]=x.useState({name:"",discountRate:0}),{grade:s,addGrade:o}=C();return e.jsxs("div",{children:[e.jsx(y,{children:"등급 관리"}),e.jsxs("div",{className:"bg-white p-4 shadow rounded",children:[e.jsx("div",{className:"flex flex-row gap-2",children:s.map(c=>e.jsxs("div",{children:[e.jsx("p",{children:c.name}),e.jsxs("p",{children:[c.discountRate,"%"]})]},c.name))}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"gradeName",children:"등급 이름"}),e.jsx("input",{type:"text",id:"gradeName",placeholder:"새로운 등급 이름",value:t.name,onChange:c=>n({...t,name:c.target.value})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"discountRate",children:"할인율"}),e.jsx("input",{type:"number",id:"discountRate",placeholder:"새로운 등급 할인율",value:t.discountRate,onChange:c=>n({...t,discountRate:parseInt(c.target.value)})})]}),e.jsx(B,{onClick:()=>o(t),children:"등급 추가"})]})]})},Ve=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],Me=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],Be=()=>e.jsx(ie,{children:e.jsx(ae,{products:Ve,children:e.jsx(de,{coupons:Me,children:e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(ue,{}),e.jsx(re,{children:e.jsx(he,{})})]})})})});U.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(Be,{})}));
