import{r as g,j as e,c as M,R as $}from"./client-DD4c7S6m.js";const E=({products:j,coupons:v})=>{const[p,f]=g.useState([]),[r,k]=g.useState(null),S=t=>{u(t)<=0||f(d=>d.find(o=>o.product.id===t.id)?d.map(o=>o.product.id===t.id?{...o,quantity:Math.min(o.quantity+1,t.stock)}:o):[...d,{product:t,quantity:1}])},l=t=>{f(a=>a.filter(d=>d.product.id!==t))},h=(t,a)=>{f(d=>d.map(c=>{if(c.product.id===t){const o=c.product.stock,y=Math.max(0,Math.min(a,o));return y>0?{...c,quantity:y}:null}return c}).filter(c=>c!==null))},m=()=>{let t=0,a=0;p.forEach(c=>{const{price:o}=c.product,{quantity:y}=c;t+=o*y;const T=c.product.discounts.reduce((D,q)=>y>=q.quantity&&q.rate>D?q.rate:D,0);a+=o*y*(1-T)});let d=t-a;return r&&(r.discountType==="amount"?a=Math.max(0,a-r.discountValue):a*=1-r.discountValue/100,d=t-a),{totalBeforeDiscount:Math.round(t),totalAfterDiscount:Math.round(a),totalDiscount:Math.round(d)}},b=t=>t.reduce((a,d)=>Math.max(a,d.rate),0),u=t=>{const a=p.find(d=>d.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},{totalBeforeDiscount:w,totalAfterDiscount:P,totalDiscount:A}=m(),N=t=>{const{discounts:a}=t.product,{quantity:d}=t;let c=0;for(const o of a)d>=o.quantity&&(c=Math.max(c,o.rate));return c},C=t=>{k(t)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:j.map(t=>{const a=u(t);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${a>0?"text-green-600":"text-red-600"}`,children:["재고: ",a,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(b(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((d,c)=>e.jsxs("li",{children:[d.quantity,"개 이상: ",(d.rate*100).toFixed(0),"% 할인"]},c))}),e.jsx("button",{onClick:()=>S(t),className:`w-full px-3 py-1 rounded ${a>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:a<=0,children:a>0?"장바구니에 추가":"품절"})]},t.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:p.map(t=>{const a=N(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,a>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(a*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>h(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>h(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>l(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)})}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:t=>C(v[parseInt(t.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),v.map((t,a)=>e.jsxs("option",{value:a,children:[t.name," - ",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`]},t.code))]}),r&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",r.name,"(",r.discountType==="amount"?`${r.discountValue}원`:`${r.discountValue}%`," 할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",w.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",A.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",P.toLocaleString(),"원"]})]})]})]})]})]})},F=({products:j,coupons:v,onProductUpdate:p,onProductAdd:f,onCouponAdd:r})=>{const[k,S]=g.useState(new Set),[l,h]=g.useState(null),[m,b]=g.useState({quantity:0,rate:0}),[u,w]=g.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[P,A]=g.useState(!1),[N,C]=g.useState({name:"",price:0,stock:0,discounts:[]}),t=s=>{S(i=>{const n=new Set(i);return n.has(s)?n.delete(s):n.add(s),n})},a=s=>{h({...s})},d=(s,i)=>{if(l&&l.id===s){const n={...l,name:i};h(n)}},c=(s,i)=>{if(l&&l.id===s){const n={...l,price:i};h(n)}},o=()=>{l&&(p(l),h(null))},y=(s,i)=>{const n=j.find(x=>x.id===s);if(n){const x={...n,stock:i};p(x),h(x)}},T=s=>{const i=j.find(n=>n.id===s);if(i&&l){const n={...i,discounts:[...i.discounts,m]};p(n),h(n),b({quantity:0,rate:0})}},D=(s,i)=>{const n=j.find(x=>x.id===s);if(n){const x={...n,discounts:n.discounts.filter((Q,I)=>I!==i)};p(x),h(x)}},q=()=>{r(u),w({name:"",code:"",discountType:"percentage",discountValue:0})},V=()=>{const s={...N,id:Date.now().toString()};f(s),C({name:"",price:0,stock:0,discounts:[]}),A(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>A(!P),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:P?"취소":"새 상품 추가"}),P&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:N.name,onChange:s=>C({...N,name:s.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:N.price,onChange:s=>C({...N,price:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:N.stock,onChange:s=>C({...N,stock:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:V,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:j.map((s,i)=>e.jsxs("div",{"data-testid":`product-${i+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>t(s.id),className:"w-full text-left font-semibold",children:[s.name," - ",s.price,"원 (재고: ",s.stock,")"]}),k.has(s.id)&&e.jsx("div",{className:"mt-2",children:l&&l.id===s.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:l.name,onChange:n=>d(s.id,n.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:l.price,onChange:n=>c(s.id,parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:l.stock,onChange:n=>y(s.id,parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),l.discounts.map((n,x)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[n.quantity,"개 이상 구매 시 ",n.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>D(s.id,x),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},x)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:m.quantity,onChange:n=>b({...m,quantity:parseInt(n.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:m.rate*100,onChange:n=>b({...m,rate:parseInt(n.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>T(s.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:o,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[s.discounts.map((n,x)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[n.quantity,"개 이상 구매 시 ",n.rate*100,"% 할인"]})},x)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>a(s),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:u.name,onChange:s=>w({...u,name:s.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:u.code,onChange:s=>w({...u,code:s.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u.discountType,onChange:s=>w({...u,discountType:s.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:u.discountValue,onChange:s=>w({...u,discountValue:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:q,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:v.map((s,i)=>e.jsxs("div",{"data-testid":`coupon-${i+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," 할인"]},i))})]})]})]})]})]})},R=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],B=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],L=()=>{const[j,v]=g.useState(R),[p,f]=g.useState(B),[r,k]=g.useState(!1),S=m=>{v(b=>b.map(u=>u.id===m.id?m:u))},l=m=>{v(b=>[...b,m])},h=m=>{f(b=>[...b,m])};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>k(!r),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:r?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:r?e.jsx(F,{products:j,coupons:p,onProductUpdate:S,onProductAdd:l,onCouponAdd:h}):e.jsx(E,{products:j,coupons:p})})]})};M.createRoot(document.getElementById("root")).render(e.jsx($.StrictMode,{children:e.jsx(L,{})}));
